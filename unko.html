<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã†ã‚“ã“ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªã‚²ãƒ¼ãƒ </title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f0e1;
            color: #5d4037;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #795548;
            margin-bottom: 30px;
        }
        .game-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        .panel {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 15px;
            margin-bottom: 20px;
        }
        .player-info {
            flex: 1;
            min-width: 300px;
        }
        .areas {
            flex: 1;
            min-width: 300px;
        }
        .inventory {
            width: 100%;
        }
        .collections {
            width: 100%;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background-color: #8d6e63;
            transition: width 0.3s ease;
        }
        button {
            background-color: #8d6e63;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            transition: background-color 0.2s;
        }
        button:hover {
            background-color: #6d4c41;
        }
        button:disabled {
            background-color: #d7ccc8;
            cursor: not-allowed;
        }
        .poop-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background-color: #f9f5ec;
            border-radius: 5px;
            transition: transform 0.2s;
        }
        .poop-item:hover {
            transform: translateX(5px);
        }
        .rarity-common { color: #757575; }
        .rarity-rare { color: #1e88e5; }
        .rarity-epic { color: #7b1fa2; }
        .rarity-legendary { color: #ff6f00; }
        .rarity-mythic { color: #d50000; }
        .collection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 10px;
        }
        .collection-item {
            background-color: #f9f5ec;
            border-radius: 5px;
            padding: 10px;
            text-align: center;
            opacity: 0.6;
        }
        .collection-item.discovered {
            opacity: 1;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .message-log {
            background-color: #fff;
            border-radius: 8px;
            padding: 10px;
            margin-top: 20px;
            max-height: 150px;
            overflow-y: auto;
        }
        .message {
            padding: 5px 0;
            border-bottom: 1px solid #f0e6d2;
        }
        .item-emoji {
            font-size: 24px;
            margin-right: 10px;
        }
        .tabs {
            display: flex;
            margin-bottom: 10px;
        }
        .tab {
            padding: 8px 15px;
            background-color: #d7ccc8;
            border: none;
            cursor: pointer;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }
        .tab.active {
            background-color: #a1887f;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        @media (max-width: 600px) {
            .game-container {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <h1>ã†ã‚“ã“ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªã‚²ãƒ¼ãƒ </h1>
    
    <div class="game-container">
        <div class="player-info panel">
            <h2>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±</h2>
            <div>
                <p>åå‰: <span id="player-name">ã†ã‚“ã“ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼</span></p>
                <p>ãƒ¬ãƒ™ãƒ«: <span id="player-level">1</span></p>
                <p>çµŒé¨“å€¤: <span id="player-exp">0</span> / <span id="player-next-level">100</span></p>
                <div class="progress-bar">
                    <div class="progress-fill" id="exp-bar" style="width: 0%"></div>
                </div>
                <p>ã‚³ã‚¤ãƒ³: <span id="player-coins">100</span></p>
                <p>ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒª: <span id="inventory-used">0</span> / <span id="inventory-max">10</span></p>
                <p>ç™ºè¦‹ç¨®é¡: <span id="discovered-types">0</span> / <span id="total-types">5</span></p>
            </div>
        </div>
        
        <div class="areas panel">
            <h2>å†’é™ºã‚¨ãƒªã‚¢</h2>
            <div>
                <button id="area-forest">ã†ã‚“ã“ã®æ£® (Lv.1+)</button>
                <button id="area-cave">ã†ã‚“ã“ã®æ´çªŸ (Lv.5+)</button>
                <button id="area-mountain">ã†ã‚“ã“å±± (Lv.10+)</button>
                <button id="area-space">ã†ã‚“ã“å®‡å®™ (Lv.20+)</button>
            </div>
            
            <div class="message-log" id="message-log">
                <div class="message">ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã—ã¾ã—ãŸã€‚å†’é™ºã‚¨ãƒªã‚¢ã‚’é¸ã‚“ã§ã†ã‚“ã“ã‚’æ¢ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼</div>
            </div>
        </div>
        
        <div class="inventory panel">
            <div class="tabs">
                <button class="tab active" data-target="inventory-tab">ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒª</button>
                <button class="tab" data-target="collections-tab">ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³</button>
            </div>
            
            <div id="inventory-tab" class="tab-content active">
                <h2>ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒª</h2>
                <div id="inventory-list">
                    <p>ã¾ã ã†ã‚“ã“ã‚’æŒã£ã¦ã„ã¾ã›ã‚“ã€‚å†’é™ºã«å‡ºã‹ã‘ã¾ã—ã‚‡ã†ï¼</p>
                </div>
            </div>
            
            <div id="collections-tab" class="tab-content">
                <h2>ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³</h2>
                <div id="collections-grid" class="collection-grid">
                    <!-- ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ãƒ†ãƒ ã¯JSã§è¿½åŠ  -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ã‚²ãƒ¼ãƒ ã‚¯ãƒ©ã‚¹
        class PoopGame {
            constructor() {
                this.player = {
                    name: "ã†ã‚“ã“ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼",
                    level: 1,
                    exp: 0,
                    maxInventorySize: 10,
                    coins: 100
                };
                
                this.inventory = [];
                this.discoveredTypes = [];
                this.collections = {};
                this.messages = [];
                
                // ã†ã‚“ã“ã‚¿ã‚¤ãƒ—ã®å®šç¾©
                this.poopTypes = [
                    { id: "normal", name: "ãƒãƒ¼ãƒãƒ«ã†ã‚“ã“", emoji: "ğŸ’©", rarity: "common", value: 5, description: "ä¸€èˆ¬çš„ãªã†ã‚“ã“ã€‚ã™ã¹ã¦ã®å†’é™ºã®å§‹ã¾ã‚Šã€‚" },
                    { id: "gold", name: "ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã†ã‚“ã“", emoji: "âœ¨ğŸ’©", rarity: "rare", value: 50, description: "è¼ãé»„é‡‘ã®ã†ã‚“ã“ã€‚å¹¸é‹ã‚’å‘¼ã¶ã¨è¨€ã‚ã‚Œã¦ã„ã‚‹ã€‚" },
                    { id: "rainbow", name: "ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼ã†ã‚“ã“", emoji: "ğŸŒˆğŸ’©", rarity: "epic", value: 200, description: "ä¸ƒè‰²ã«è¼ããƒ¬ã‚¢ãªã†ã‚“ã“ã€‚ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã®é–“ã§å¤§äººæ°—ã€‚" },
                    { id: "ancient", name: "å¤ä»£ã†ã‚“ã“", emoji: "ğŸºğŸ’©", rarity: "legendary", value: 500, description: "ä½•åƒå¹´ã‚‚å‰ã®ç”Ÿç‰©ã®ã†ã‚“ã“ã®åŒ–çŸ³ã€‚æ­´å²çš„ä¾¡å€¤ãŒã‚ã‚‹ã€‚" },
                    { id: "alien", name: "ã‚¨ã‚¤ãƒªã‚¢ãƒ³ã†ã‚“ã“", emoji: "ğŸ‘½ğŸ’©", rarity: "mythic", value: 1000, description: "å®‡å®™ã‹ã‚‰ã®æ¥è¨ªè€…ãŒæ®‹ã—ãŸãƒŸã‚¹ãƒ†ãƒªã‚¢ã‚¹ãªã†ã‚“ã“ã€‚æœªçŸ¥ã®åŠ›ã‚’ç§˜ã‚ã¦ã„ã‚‹ã€‚" },
                ];
                
                // å†’é™ºã‚¨ãƒªã‚¢ã®å®šç¾©
                this.areas = [
                    { id: "forest", name: "ã†ã‚“ã“ã®æ£®", minLevel: 1, poopChance: { normal: 0.8, gold: 0.15, rainbow: 0.04, ancient: 0.01, alien: 0 } },
                    { id: "cave", name: "ã†ã‚“ã“ã®æ´çªŸ", minLevel: 5, poopChance: { normal: 0.6, gold: 0.25, rainbow: 0.1, ancient: 0.05, alien: 0 } },
                    { id: "mountain", name: "ã†ã‚“ã“å±±", minLevel: 10, poopChance: { normal: 0.4, gold: 0.3, rainbow: 0.2, ancient: 0.09, alien: 0.01 } },
                    { id: "space", name: "ã†ã‚“ã“å®‡å®™", minLevel: 20, poopChance: { normal: 0.2, gold: 0.3, rainbow: 0.3, ancient: 0.15, alien: 0.05 } }
                ];
            }
            
            // ã†ã‚“ã“ã‚’è¦‹ã¤ã‘ã‚‹
            findPoop(areaId) {
                const area = this.areas.find(a => a.id === areaId);
                if (!area) return null;
                
                if (this.player.level < area.minLevel) {
                    return { success: false, message: `ãƒ¬ãƒ™ãƒ«${area.minLevel}ä»¥ä¸Šã§ãªã„ã¨${area.name}ã«å…¥ã‚Œã¾ã›ã‚“ï¼` };
                }
                
                if (this.inventory.length >= this.player.maxInventorySize) {
                    return { success: false, message: "ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªãŒã„ã£ã±ã„ã§ã™ï¼ã†ã‚“ã“ã‚’å£²ã‚‹ã‹æ¨ã¦ã¦ãã ã•ã„ã€‚" };
                }
                
                // ã†ã‚“ã“ã‚¿ã‚¤ãƒ—ã®æ±ºå®š
                const rand = Math.random();
                let cumulativeChance = 0;
                let foundType = null;
                
                for (const [typeId, chance] of Object.entries(area.poopChance)) {
                    cumulativeChance += chance;
                    if (rand <= cumulativeChance) {
                        foundType = this.poopTypes.find(p => p.id === typeId);
                        break;
                    }
                }
                
                if (!foundType) {
                    return { success: false, message: "ä»Šå›ã¯ä½•ã‚‚è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚" };
                }
                
                // æ–°ã—ã„ã†ã‚“ã“ã‚’ç”Ÿæˆ
                const newPoop = {
                    id: Date.now(),
                    typeId: foundType.id,
                    name: foundType.name,
                    emoji: foundType.emoji,
                    rarity: foundType.rarity,
                    value: foundType.value + Math.floor(Math.random() * 10), // å€¤æ®µã®å¾®å¤‰å‹•
                    found: new Date().toLocaleString(),
                    area: area.name
                };
                
                // ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªã«è¿½åŠ 
                this.inventory.push(newPoop);
                
                // ç™ºè¦‹ã—ãŸã‚¿ã‚¤ãƒ—ã‚’è¨˜éŒ²
                if (!this.discoveredTypes.includes(foundType.id)) {
                    this.discoveredTypes.push(foundType.id);
                    this.addExp(foundType.value); // æ–°ã—ã„ã‚¿ã‚¤ãƒ—ç™ºè¦‹ã§çµŒé¨“å€¤ç²å¾—
                } else {
                    this.addExp(Math.ceil(foundType.value / 10)); // é€šå¸¸ã®çµŒé¨“å€¤ç²å¾—
                }
                
                return { 
                    success: true, 
                    message: `${area.name}ã§${newPoop.name}ã‚’è¦‹ã¤ã‘ã¾ã—ãŸï¼`, 
                    poop: newPoop 
                };
            }
            
            // ã†ã‚“ã“ã‚’å£²ã‚‹
            sellPoop(poopId) {
                const index = this.inventory.findIndex(p => p.id === parseInt(poopId));
                if (index === -1) {
                    return { success: false, message: "ãã®ã†ã‚“ã“ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚" };
                }
                
                const poop = this.inventory[index];
                this.player.coins += poop.value;
                this.inventory.splice(index, 1);
                
                return { 
                    success: true, 
                    message: `${poop.name}ã‚’${poop.value}ã‚³ã‚¤ãƒ³ã§å£²ã‚Šã¾ã—ãŸï¼`, 
                    coins: this.player.coins 
                };
            }
            
            // çµŒé¨“å€¤ã®è¿½åŠ ã¨ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ã®å‡¦ç†
            addExp(exp) {
                this.player.exp += exp;
                const nextLevelThreshold = this.player.level * 100;
                
                if (this.player.exp >= nextLevelThreshold) {
                    this.player.level++;
                    this.player.exp -= nextLevelThreshold;
                    
                    // ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ãƒœãƒ¼ãƒŠã‚¹
                    if (this.player.level % 5 === 0) {
                        this.player.maxInventorySize += 5;
                        return { 
                            levelUp: true, 
                            message: `ãƒ¬ãƒ™ãƒ«${this.player.level}ã«ãªã‚Šã¾ã—ãŸï¼ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªå®¹é‡ãŒ5å¢—åŠ ã—ã¾ã—ãŸï¼` 
                        };
                    }
                    
                    return { 
                        levelUp: true, 
                        message: `ãƒ¬ãƒ™ãƒ«${this.player.level}ã«ãªã‚Šã¾ã—ãŸï¼` 
                    };
                }
                
                return { levelUp: false };
            }
            
            // ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®çŠ¶æ…‹ã‚’ç¢ºèª
            checkCollections() {
                let collections = {};
                
                for (const type of this.poopTypes) {
                    collections[type.id] = {
                        name: type.name,
                        emoji: type.emoji,
                        discovered: this.discoveredTypes.includes(type.id),
                        description: type.description,
                        rarity: type.rarity
                    };
                }
                
                return collections;
            }
            
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®çŠ¶æ…‹ã‚’å–å¾—
            getPlayerStatus() {
                return {
                    name: this.player.name,
                    level: this.player.level,
                    exp: this.player.exp,
                    nextLevel: this.player.level * 100,
                    expPercentage: Math.floor((this.player.exp / (this.player.level * 100)) * 100),
                    maxInventorySize: this.player.maxInventorySize,
                    inventoryUsed: this.inventory.length,
                    coins: this.player.coins,
                    discoveredTypes: this.discoveredTypes.length,
                    totalTypes: this.poopTypes.length
                };
            }
            
            // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ 
            addMessage(message) {
                this.messages.unshift(message);
                if (this.messages.length > 20) {
                    this.messages.pop();
                }
            }
        }

        // ã‚²ãƒ¼ãƒ ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
        const game = new PoopGame();

        // DOMè¦ç´ 
        const playerName = document.getElementById('player-name');
        const playerLevel = document.getElementById('player-level');
        const playerExp = document.getElementById('player-exp');
        const playerNextLevel = document.getElementById('player-next-level');
        const playerCoins = document.getElementById('player-coins');
        const expBar = document.getElementById('exp-bar');
        const inventoryUsed = document.getElementById('inventory-used');
        const inventoryMax = document.getElementById('inventory-max');
        const discoveredTypes = document.getElementById('discovered-types');
        const totalTypes = document.getElementById('total-types');
        const messageLog = document.getElementById('message-log');
        const inventoryList = document.getElementById('inventory-list');
        const collectionsGrid = document.getElementById('collections-grid');

        // ã‚¨ãƒªã‚¢ãƒœã‚¿ãƒ³
        const areaButtons = {
            forest: document.getElementById('area-forest'),
            cave: document.getElementById('area-cave'),
            mountain: document.getElementById('area-mountain'),
            space: document.getElementById('area-space')
        };

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        const tabs = document.querySelectorAll('.tab');
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ãƒ–ã‚’åˆ‡ã‚Šæ›¿ãˆ
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’åˆ‡ã‚Šæ›¿ãˆ
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                document.getElementById(tab.dataset.target).classList.add('active');
            });
        });

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±ã®æ›´æ–°
        function updatePlayerInfo() {
            const status = game.getPlayerStatus();
            playerName.textContent = status.name;
            playerLevel.textContent = status.level;
            playerExp.textContent = status.exp;
            playerNextLevel.textContent = status.nextLevel;
            playerCoins.textContent = status.coins;
            expBar.style.width = `${status.expPercentage}%`;
            inventoryUsed.textContent = status.inventoryUsed;
            inventoryMax.textContent = status.maxInventorySize;
            discoveredTypes.textContent = status.discoveredTypes;
            totalTypes.textContent = status.totalTypes;
            
            // ã‚¨ãƒªã‚¢ãƒœã‚¿ãƒ³ã®æœ‰åŠ¹/ç„¡åŠ¹ã‚’æ›´æ–°
            for (const area of game.areas) {
                areaButtons[area.id].disabled = status.level < area.minLevel;
            }
        }

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ­ã‚°ã®æ›´æ–°
        function updateMessageLog() {
            messageLog.innerHTML = '';
            game.messages.forEach(message => {
                const messageElement = document.createElement('div');
                messageElement.className = 'message';
                messageElement.textContent = message;
                messageLog.appendChild(messageElement);
            });
        }

        // ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªãƒªã‚¹ãƒˆã®æ›´æ–°
        function updateInventory() {
            if (game.inventory.length === 0) {
                inventoryList.innerHTML = '<p>ã¾ã ã†ã‚“ã“ã‚’æŒã£ã¦ã„ã¾ã›ã‚“ã€‚å†’é™ºã«å‡ºã‹ã‘ã¾ã—ã‚‡ã†ï¼</p>';
                return;
            }
            
            inventoryList.innerHTML = '';
            game.inventory.forEach(poop => {
                const item = document.createElement('div');
                item.className = `poop-item rarity-${poop.rarity}`;
                item.innerHTML = `
                    <div>
                        <span class="item-emoji">${poop.emoji}</span>
                        <strong>${poop.name}</strong> (${poop.value}ã‚³ã‚¤ãƒ³)
                    </div>
                    <div>
                        <button class="sell-button" data-id="${poop.id}">å£²ã‚‹</button>
                    </div>
                `;
                inventoryList.appendChild(item);
            });
            
            // å£²ã‚‹ãƒœã‚¿ãƒ³ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
            document.querySelectorAll('.sell-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const poopId = e.target.dataset.id;
                    const result = game.sellPoop(poopId);
                    game.addMessage(result.message);
                    updateAll();
                });
            });
        }

        // ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®æ›´æ–°
        function updateCollections() {
            const collections = game.checkCollections();
            collectionsGrid.innerHTML = '';
            
            for (const [id, item] of Object.entries(collections)) {
                const collectionItem = document.createElement('div');
                collectionItem.className = `collection-item rarity-${item.rarity} ${item.discovered ? 'discovered' : ''}`;
                
                if (item.discovered) {
                    collectionItem.innerHTML = `
                        <div class="item-emoji">${item.emoji}</div>
                        <h3>${item.name}</h3>
                        <p>${item.description}</p>
                    `;
                } else {
                    collectionItem.innerHTML = `
                        <div class="item-emoji">â“</div>
                        <h3>???</h3>
                        <p>ã¾ã ç™ºè¦‹ã—ã¦ã„ã¾ã›ã‚“</p>
                    `;
                }
                
                collectionsGrid.appendChild(collectionItem);
            }
        }

        // å…¨ã¦ã®è¡¨ç¤ºã‚’æ›´æ–°
        function updateAll() {
            updatePlayerInfo();
            updateMessageLog();
            updateInventory();
            updateCollections();
        }

        // ã‚¨ãƒªã‚¢ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        for (const [areaId, button] of Object.entries(areaButtons)) {
            button.addEventListener('click', () => {
                const result = game.findPoop(areaId);
                game.addMessage(result.message);
                
                if (result.success && result.levelUp) {
                    game.addMessage(result.levelUp.message);
                }
                
                updateAll();
            });
        }

        // åˆæœŸè¡¨ç¤ºã‚’æ›´æ–°
        updateAll();
    </script>
</body>
</html>